<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ØªØ§Ø± Ø¬ÙŠÙ…Ø² | Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    
    <!-- Ù…ÙƒØªØ¨Ø§Øª Firebase (Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ) -->
    <script src="https://www.gstatic.com"></script>
    <script src="https://www.gstatic.com"></script>
    <script src="https://www.gstatic.com"></script>

    <style>
        body { font-family: 'Changa', sans-serif; background: #05070a; color: #f8fafc; }
        .neon-text { text-shadow: 0 0 10px rgba(59, 130, 246, 0.8); }
        .game-card { background: #0f172a; border-radius: 20px; overflow: hidden; border: 1px solid #1e293b; transition: 0.3s; cursor: pointer; }
        .game-card:hover { border-color: #3b82f6; transform: translateY(-5px); }
        .img-placeholder { display: flex; align-items: center; justify-content: center; height: 128px; }
    </style>
</head>
<body>

    <header class="p-4 bg-slate-950 border-b border-blue-900/50 flex justify-between items-center sticky top-0 z-50">
        <div class="text-2xl font-black neon-text italic text-blue-400 font-bold">STARGAMES</div>
        <div class="flex items-center gap-3">
            <button id="loginBtn" onclick="googleLogin()" class="bg-blue-600 px-4 py-1 rounded-lg text-xs font-bold">Ø¯Ø®ÙˆÙ„ ðŸ‘¤</button>
            <div class="bg-yellow-400/10 border border-yellow-400/20 px-3 py-1 rounded-full text-yellow-400 font-bold">
                <span id="userPoints">0</span> ðŸª™
            </div>
        </div>
    </header>

    <main class="container mx-auto p-6 grid grid-cols-2 md:grid-cols-4 gap-6" id="gameGrid"></main>

    <div id="gameRoom" class="fixed inset-0 bg-black hidden z-50 flex flex-col">
        <div class="p-4 bg-slate-900 flex justify-between items-center">
            <button onclick="exitGame()" class="bg-red-600 px-6 py-1 rounded-full font-bold">Ø®Ø±ÙˆØ¬ ðŸšª</button>
            <div class="text-yellow-400 font-bold">Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬Ù„Ø³Ø©: <span id="sessionPoints">0</span></div>
        </div>
        <iframe id="gFrame" class="w-full h-full border-none bg-white"></iframe>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (Ø¶Ø¹ Ù…ÙØ§ØªÙŠØ­Ùƒ Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
        const firebaseConfig = { apiKey: "AIzaSy...", authDomain: "games-c6.firebaseapp.com", projectId: "games-c6", appId: "1:777:web:abc" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let totalPoints = parseInt(localStorage.getItem('totalPoints')) || 0;
        let sessionTimer;
        document.getElementById('userPoints').innerText = totalPoints;

        const gamesList = [
            { title: "Ø³Ø­Ù‚ Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ", icon: "ðŸ§Ÿ", color: "#10b981", url: "https://www.gamepix.com" },
            { title: "Ù‡Ø±ÙˆØ¨ Ø§Ù„Ù…Ø¹Ø¨Ø¯ 2", icon: "ðŸƒâ€â™‚ï¸", color: "#f59e0b", url: "https://www.gamepix.com" },
            { title: "Ø³Ø¨Ø§Ù‚ Ø§Ù„Ø´ÙˆØ§Ø±Ø¹", icon: "ðŸŽï¸", color: "#3b82f6", url: "https://www.gamepix.com" },
            { title: "ØªØ­Ø¯ÙŠ Ø§Ù„Ø³ÙƒÙŠÙ†", icon: "ðŸ”ª", color: "#ef4444", url: "https://www.gamepix.com" }
        ];

        function showGames() {
            const grid = document.getElementById('gameGrid');
            grid.innerHTML = gamesList.map(game => `
                <div onclick="openGame('${game.url}')" class="game-card">
                    <div class="img-placeholder" style="background: ${game.color}33">
                        <span class="text-5xl">${game.icon}</span>
                    </div>
                    <div class="p-3 text-center text-xs font-bold">${game.title}</div>
                </div>
            `).join('');
        }

        // ÙˆØ¸ÙŠÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Ø¬ÙˆØ¬Ù„
        function googleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then((result) => {
                const user = result.user;
                document.getElementById('loginBtn').innerText = user.displayName.split(' ')[0];
                alert(`Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ ${user.displayName}!`);
                loadUserPoints(user.uid);
            }).catch((error) => alert("ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: " + error.message));
        }

        function loadUserPoints(uid) {
            db.collection("users").doc(uid).get().then((doc) => {
                if (doc.exists) {
                    totalPoints = doc.data().points;
                    document.getElementById('userPoints').innerText = totalPoints;
                }
            });
        }

        function savePoints(uid, points) {
            db.collection("users").doc(uid).set({ points: points }, { merge: true });
        }

        function openGame(url) {
            document.getElementById('gFrame').src = url;
            document.getElementById('gameRoom').classList.remove('hidden');
            let sPoints = 0;
            sessionTimer = setInterval(() => {
                sPoints += 1;
                document.getElementById('sessionPoints').innerText = sPoints;
            }, 3000);
        }

        function exitGame() {
            clearInterval(sessionTimer);
            let sPoints = parseInt(document.getElementById('sessionPoints').innerText);
            totalPoints += sPoints;
            localStorage.setItem('totalPoints', totalPoints);
            document.getElementById('userPoints').innerText = totalPoints;
            
            const user = auth.currentUser;
            if (user) savePoints(user.uid, totalPoints);

            document.getElementById('gameRoom').classList.add('hidden');
            document.getElementById('gFrame').src = "";
            document.getElementById('sessionPoints').innerText = "0";
        }

        showGames();
    </script>
</body>
</html>
